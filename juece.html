<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æˆ¿è´· + èµ„äº§è”åŠ¨è®¡ç®—å™¨</title>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">

<style>
body { padding: 20px; }
.card { border-radius: 8px; }
.result { background: #f8f9fa; padding: 12px; border-radius: 6px; }
</style>
</head>
<body>

<div id="app" class="container">

<div class="row">

<!-- ========== å·¦ä¾§ ========== -->
<div class="col-md-6">
<div class="card p-3">

<h5>ğŸ  æå‰è¿˜è´·è®¡ç®—å™¨</h5>

<div class="form-group">
<label>å‰©ä½™è´·æ¬¾æœ¬é‡‘ï¼ˆå…ƒï¼‰</label>
<input type="number" class="form-control" v-model.number="loanPrincipal">
</div>

<div class="form-group">
<label>å‰©ä½™æœŸæ•°ï¼ˆæœˆï¼‰</label>
<input type="number" class="form-control" v-model.number="loanMonths">
</div>

<div class="form-group">
<label>å¹´åˆ©ç‡ (%)</label>
<input type="number" class="form-control" v-model.number="loanRate" step="0.01">
</div>

<div class="form-group">
<label>æå‰è¿˜æ¬¾é‡‘é¢ï¼ˆå…ƒï¼‰</label>
<input type="number" class="form-control" v-model.number="prepayAmount">
</div>

<div class="form-group">
<label>å…¬ç§¯é‡‘æ¯æœˆæŠµæ‰£ï¼ˆå…ƒï¼‰</label>
<input type="number" class="form-control" v-model.number="housingFund">
</div>

<div class="result mt-3">
<p>ğŸ“Œ å½“å‰æœˆä¾›ï¼š<b>{{ currentMonthly.toFixed(2) }}</b> å…ƒ</p>
<p>ğŸ“Œ æå‰è¿˜è´·åæœˆä¾›ï¼š<b>{{ newMonthly.toFixed(2) }}</b> å…ƒ</p>
<p>ğŸ“‰ æœˆä¾›å‡å°‘ï¼š<b>{{ (currentMonthly - newMonthly).toFixed(2) }}</b> å…ƒ</p>
<p>ğŸ¦ æ‰£å…¬ç§¯é‡‘åå®é™…æ”¯å‡ºï¼š<b>{{ actualMonthlyOut.toFixed(2) }}</b> å…ƒ</p>
</div>

</div>
</div>

<!-- ========== å³ä¾§ ========== -->
<div class="col-md-6">
<div class="card p-3">

<h5>ğŸ“ˆ å‰©ä½™èµ„äº§å¢é•¿è®¡ç®—å™¨</h5>

<div class="form-group">
<label>åˆå§‹èµ„äº§ï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰</label>
<input type="number" class="form-control" v-model.number="assetPrincipal" disabled>
</div>

<div class="form-group">
<label>å¹´åŒ–å­˜æ¬¾åˆ©ç‡ (%)</label>
<input type="number" class="form-control" v-model.number="depositRate" step="0.01">
</div>

<div class="form-group">
<label>æ¯æœˆå¯ç»“ä½™æ”¶å…¥ï¼ˆå¯ä¿®æ”¹ï¼‰</label>
<input type="number" class="form-control" v-model.number="monthlyIncome">
</div>

<div class="form-group">
<label>è®¡ç®—æœˆæ•°</label>
<input type="number" class="form-control" v-model.number="assetMonths">
</div>

<div class="result mt-3">
<p>ğŸ’° æœ€ç»ˆèµ„äº§ï¼š <b>{{ finalAsset.toFixed(2) }}</b> å…ƒ</p>
<p>ğŸ“¥ ç´¯è®¡å‡€æ”¶å…¥ï¼š {{ totalIncome.toFixed(2) }} å…ƒ</p>
<p>ğŸ“ˆ ç´¯è®¡åˆ©æ¯ï¼š {{ totalInterest.toFixed(2) }} å…ƒ</p>
</div>

</div>
</div>

</div>
</div>

<script>
new Vue({
el: '#app',
data: {
    // é»˜è®¤å€¼
    loanPrincipal: 350000,
    loanMonths: 240,
    loanRate: 3.1,
    prepayAmount: 0,
    housingFund: 616,

    depositRate: 2.0,
    assetMonths: 60,

    assetPrincipal: 350000,
    monthlyIncome: 0,

    finalAsset: 0,
    totalIncome: 0,
    totalInterest: 0
},

computed: {

    currentMonthly() {
        const P = this.loanPrincipal;
        const n = this.loanMonths;
        const i = this.loanRate / 100 / 12;
        if (P <= 0 || n <= 0) return 0;
        if (i === 0) return P / n;
        return P * (i * Math.pow(1 + i, n)) / (Math.pow(1 + i, n) - 1);
    },

    newMonthly() {
        const P = Math.max(0, this.loanPrincipal - this.prepayAmount);
        const n = this.loanMonths;
        const i = this.loanRate / 100 / 12;
        if (P <= 0 || n <= 0) return 0;
        if (i === 0) return P / n;
        return P * (i * Math.pow(1 + i, n)) / (Math.pow(1 + i, n) - 1);
    },

    actualMonthlyOut() {
        return Math.max(0, this.newMonthly - this.housingFund);
    }
},

watch: {

    loanPrincipal(val) {
        this.assetPrincipal = val;
        this.recalcIncome();
        this.calculateAsset();
    },

    actualMonthlyOut() {
        this.recalcIncome();
        this.calculateAsset();
    },

    depositRate: 'calculateAsset',
    assetMonths: 'calculateAsset',
    monthlyIncome: 'calculateAsset'
},

mounted() {
    this.assetPrincipal = this.loanPrincipal;
    this.recalcIncome();
    this.calculateAsset();
},

methods: {

    recalcIncome() {
        this.monthlyIncome = Number((3000 - this.actualMonthlyOut).toFixed(2));
    },

    calculateAsset() {
        let balance = Number(this.assetPrincipal) || 0;
        let income = Number(this.monthlyIncome) || 0;
        let months = Number(this.assetMonths) || 0;
        let rate = (Number(this.depositRate) || 0) / 100 / 12;

        let totalIncome = 0;
        let totalInterest = 0;

        for (let i = 0; i < months; i++) {
            balance += income;
            totalIncome += income;

            if (balance > 0 && rate > 0) {
                const interest = balance * rate;
                balance += interest;
                totalInterest += interest;
            }
        }

        this.finalAsset = Number(balance.toFixed(2));
        this.totalIncome = Number(totalIncome.toFixed(2));
        this.totalInterest = Number(totalInterest.toFixed(2));
    }
}
});
</script>

</body>
</html>
