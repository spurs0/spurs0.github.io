<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æå‰è¿˜è´· + å‰©ä½™èµ„äº§è”åŠ¨è®¡ç®—å™¨</title>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<style>
body {
    background: #f7f7f7;
}
.container {
    max-width: 1100px;
}
.card {
    border-radius: 10px;
}
.result-box {
    background: #fafafa;
    padding: 12px;
    border-radius: 6px;
    margin-top: 10px;
}
</style>
</head>

<body>
<div id="app" class="container mt-4">

    <h3 class="mb-3 text-center">ğŸ  æå‰è¿˜è´· + ğŸ’° å‰©ä½™èµ„äº§è”åŠ¨è®¡ç®—å™¨</h3>

    <div class="row">

        <!-- å·¦ä¾§ -->
        <div class="col-md-6 mb-3">
            <div class="card p-3">

                <h5>æå‰è¿˜è´·è®¡ç®—</h5>

                <div class="form-group">
                    <label>å‰©ä½™è´·æ¬¾æœ¬é‡‘</label>
                    <input type="number" class="form-control" v-model.number="loanPrincipal">
                </div>

                <div class="form-group">
                    <label>è´·æ¬¾å¹´åˆ©ç‡ (%)</label>
                    <input type="number" class="form-control" v-model.number="loanRate" step="0.01">
                </div>

                <div class="form-group">
                    <label>å‰©ä½™æœŸæ•° (æœˆ)</label>
                    <input type="number" class="form-control" v-model.number="months">
                </div>

                <div class="form-group">
                    <label>æå‰è¿˜æ¬¾é‡‘é¢</label>
                    <input type="number" class="form-control" v-model.number="prepayAmount">
                </div>

                <div class="form-group">
                    <label>å…¬ç§¯é‡‘æŠµæ‰£</label>
                    <input type="number" class="form-control" v-model.number="housingFund">
                </div>

                <div class="result-box">
                    <div>å½“å‰æœˆä¾›ï¼š<b>{{ currentMonthly.toFixed(2) }}</b></div>
                    <div>æå‰è¿˜æ¬¾åæœˆä¾›ï¼š<b>{{ newMonthly.toFixed(2) }}</b></div>
                    <div>æ‰£å…¬ç§¯é‡‘åå®é™…æœˆä¾›ï¼š<b>{{ actualMonthlyOut.toFixed(2) }}</b></div>
                </div>

            </div>
        </div>

        <!-- å³ä¾§ -->
        <div class="col-md-6 mb-3">
            <div class="card p-3">

                <h5>èµ„äº§å¢é•¿æ¨¡æ‹Ÿ</h5>

                <div class="form-group">
                    <label>åˆå§‹èµ„äº§ï¼ˆè‡ªåŠ¨è”åŠ¨ï¼‰</label>
                    <input type="number" class="form-control" :value="assetBase.toFixed(2)" disabled>
                </div>

                <div class="form-group">
                    <label>å­˜æ¬¾åˆ©ç‡(å¹´) (%)</label>
                    <input type="number" class="form-control" v-model.number="depositRate" step="0.01">
                </div>

                <div class="form-group">
                    <label>æ¯æœˆæ”¶å…¥ï¼ˆä¾‹ï¼šå·¥èµ„ï¼‰</label>
                    <input type="number" class="form-control" v-model.number="monthlyIncome">
                </div>

                <div class="form-group">
                    <label>æ¯æœˆæ”¯å‡ºï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰</label>
                    <input type="number" class="form-control" :value="monthlyBalance.toFixed(2)" disabled>
                </div>

                <div class="result-box">
                    <div>
                        {{ months }}ä¸ªæœˆä¹‹åï¼Œèµ„äº§æ€»é¢ä¸ºï¼š
                        <b>{{ finalAsset.toFixed(2) }}</b>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

<script>
new Vue({
    el: '#app',

    data: {
        loanPrincipal: 325000,
        loanRate: 3.1,
        months: 60,
        prepayAmount: 50000,
        housingFund: 616,

        depositRate: 2.0,
        monthlyIncome: 0,

        finalAsset: 0
    },

    computed: {

        monthlyLoanRate() {
            return this.loanRate / 100 / 12;
        },

        // å½“å‰æœˆä¾›
        currentMonthly() {
            if (this.months <= 0) return 0;
            let r = this.monthlyLoanRate;
            let n = this.months;
            let p = this.loanPrincipal;
            return p * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
        },

        // æå‰è¿˜æ¬¾åçš„æœˆä¾›
        newMonthly() {
            let remain = Math.max(0, this.loanPrincipal - this.prepayAmount);
            if (remain === 0 || this.months <= 0) return 0;
            let r = this.monthlyLoanRate;
            let n = this.months;
            return remain * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
        },

        // æ‰£é™¤å…¬ç§¯é‡‘åçš„å®é™…æœˆä¾›
        actualMonthlyOut() {
            return Math.max(0, this.newMonthly - this.housingFund);
        },

        // å³ä¾§åˆå§‹èµ„äº§
        assetBase() {
            return Math.max(0, this.loanPrincipal - this.prepayAmount);
        },

        // æ¯æœˆå¯ç»“ä½™ï¼ˆæ”¶å…¥ - å®é™…æ”¯å‡ºï¼‰
        monthlyBalance() {
            return this.monthlyIncome - this.actualMonthlyOut;
        }
    },

    watch: {
        assetBase: {
            immediate: true,
            handler() {
                this.calculateAsset();
            }
        },
        monthlyBalance() {
            this.calculateAsset();
        },
        depositRate() {
            this.calculateAsset();
        },
        months() {
            this.calculateAsset();
        }
    },

    methods: {

        calculateAsset() {
            let amount = this.assetBase;
            let monthlyRate = this.depositRate / 100 / 12;

            for (let i = 0; i < this.months; i++) {
                amount += this.monthlyBalance;
                amount *= (1 + monthlyRate);
            }

            this.finalAsset = amount;
        }

    }
});
</script>

</body>
</html>
