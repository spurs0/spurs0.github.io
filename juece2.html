<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>提前还贷 + 剩余资产联动计算器</title>

<script src="//cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<style>
body { background:#f6f6f6; }
.container { max-width: 980px; }
.card { border-radius: 10px; }
.result { background:#fafafa; padding:10px; border-radius:6px; margin-top:10px; }
</style>
</head>

<body>
<div id="app" class="container mt-4">

<h4 class="text-center mb-3">提前还贷 + 剩余资产联动计算器</h4>

<div class="row">

<!-- 左侧 -->
<div class="col-md-6 mb-3">
<div class="card p-3">

<h5>提前还贷计算</h5>

<div class="form-group">
<label>剩余贷款本金</label>
<input type="number" class="form-control" v-model.number="loanPrincipal">
</div>

<div class="form-group">
<label>贷款年利率 (%)</label>
<input type="number" class="form-control" v-model.number="loanRate" step="0.01">
</div>

<div class="form-group">
<label>剩余期数 (月)</label>
<input type="number" class="form-control" v-model.number="months">
</div>

<div class="form-group">
<label>提前还款金额</label>
<input type="number" class="form-control" v-model.number="prepayAmount">
</div>

<div class="form-group">
<label>公积金抵扣</label>
<input type="number" class="form-control" v-model.number="housingFund">
</div>

<div class="result">
<div>当前月供：<b>{{ currentMonthly.toFixed(2) }}</b></div>
<div>提前还款后月供：<b>{{ newMonthly.toFixed(2) }}</b></div>
<div>扣除公积金后的实际月供：<b>{{ actualMonthlyOut.toFixed(2) }}</b></div>
</div>

</div>
</div>

<!-- 右侧 -->
<div class="col-md-6 mb-3">
<div class="card p-3">

<h5>资产增长模拟</h5>

<div class="form-group">
<label>初始资产（自动联动）</label>
<input type="number" class="form-control" :value="assetBase.toFixed(2)" disabled>
</div>

<div class="form-group">
<label>存款利率(年) (%)</label>
<input type="number" class="form-control" v-model.number="depositRate" step="0.01">
</div>

<!-- 新增 -->
<div class="form-group">
<label>每月收入（例：工资）</label>
<input type="number" class="form-control" v-model.number="monthlyIncome">
</div>

<!-- 修改 -->
<div class="form-group">
<label>每月支出（自动计算）</label>
<input type="number" class="form-control" :value="monthlyBalance.toFixed(2)" disabled>
</div>

<div class="result">
<div>{{ months }}个月之后，资产总额为：</div>
<div style="font-size:18px"><b>{{ finalAsset.toFixed(2) }}</b></div>
</div>

</div>
</div>

</div>
</div>

<script>
new Vue({
el:"#app",

data:{
    loanPrincipal:325000,
    loanRate:3.1,
    months:60,
    prepayAmount:50000,
    housingFund:616,

    depositRate:2.0,
    monthlyIncome:0,

    finalAsset:0
},

computed:{

    monthlyLoanRate(){
        return this.loanRate/100/12;
    },

    currentMonthly(){
        if(this.months<=0) return 0;
        let r=this.monthlyLoanRate,n=this.months,p=this.loanPrincipal;
        return p*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
    },

    newMonthly(){
        let remain=Math.max(0,this.loanPrincipal-this.prepayAmount);
        if(remain===0||this.months<=0) return 0;
        let r=this.monthlyLoanRate,n=this.months;
        return remain*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
    },

    actualMonthlyOut(){
        return Math.max(0,this.newMonthly-this.housingFund);
    },

    assetBase(){
        return Math.max(0,this.loanPrincipal-this.prepayAmount);
    },

    // ✅ 修改后的现金流逻辑
    monthlyBalance(){
        return this.monthlyIncome - this.actualMonthlyOut;
    }
},

watch:{
    assetBase:{ immediate:true, handler(){ this.calculateAsset(); }},
    monthlyBalance(){ this.calculateAsset(); },
    depositRate(){ this.calculateAsset(); },
    months(){ this.calculateAsset(); }
},

methods:{
    calculateAsset(){
        let amount=this.assetBase;
        let r=this.depositRate/100/12;

        for(let i=0;i<this.months;i++){
            amount+=this.monthlyBalance;
            amount*=1+r;
        }

        this.finalAsset=amount;
    }
}
});
</script>

</body>
</html>
