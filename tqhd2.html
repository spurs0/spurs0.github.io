<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æå‰è¿˜è´·æœˆä¾›è®¡ç®—å™¨</title>

<script src="//cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">

<style>
body {
    padding: 20px;
}
.result {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 6px;
}
</style>
</head>
<body>

<div id="app" class="container mt-4">

    <h4 class="mb-3">ğŸ  æå‰è¿˜è´·æœˆä¾›è®¡ç®—å™¨ï¼ˆåŸºäºå‰©ä½™æœ¬é‡‘ï¼‰</h4>

    <!-- è¾“å…¥åŒº -->
    <div class="form-group">
        <label>å‰©ä½™è´·æ¬¾æœ¬é‡‘ï¼ˆå…ƒï¼‰</label>
        <input type="number" class="form-control" v-model.number="principal">
    </div>

    <div class="form-group">
        <label>å‰©ä½™è¿˜æ¬¾æœŸæ•°ï¼ˆæœˆï¼‰</label>
        <input type="number" class="form-control" v-model.number="months">
    </div>

    <div class="form-group">
        <label>å¹´åˆ©ç‡ (%)</label>
        <input type="number" class="form-control" v-model.number="annualRate" step="0.01">
    </div>

    <div class="form-group">
        <label>æå‰è¿˜æ¬¾é‡‘é¢ï¼ˆå…ƒï¼‰</label>
        <input type="number" class="form-control" v-model.number="prepayAmount">
    </div>

    <!-- ç»“æœ -->
    <div class="result mt-4">
        <h5>è®¡ç®—ç»“æœ</h5>

        <p>ğŸ“Œ å½“å‰æœˆä¾›ï¼š<b>{{ currentMonthly.toFixed(2) }}</b> å…ƒ</p>
        <p>ğŸ“Œ æå‰è¿˜è´·åæœˆä¾›ï¼š<b>{{ newMonthly.toFixed(2) }}</b> å…ƒ</p>
        <p>ğŸ“‰ æ¯æœˆå‡å°‘é‡‘é¢ï¼š<b>{{ (currentMonthly - newMonthly).toFixed(2) }}</b> å…ƒ</p>

        <hr>

        <p>ğŸ’° å½“å‰å‰©ä½™æ€»è¿˜æ¬¾ï¼š{{ totalPayBefore.toFixed(2) }} å…ƒ</p>
        <p>ğŸ’° æå‰è¿˜è´·åæ€»è¿˜æ¬¾ï¼š{{ totalPayAfter.toFixed(2) }} å…ƒ</p>
        <p>ğŸ’¡ èŠ‚çœæ€»é‡‘é¢ï¼š<b>{{ (totalPayBefore - totalPayAfter).toFixed(2) }}</b> å…ƒ</p>
    </div>

</div>

<script>
new Vue({
    el: '#app',
    data: {
        principal: 350000,     // å‰©ä½™æœ¬é‡‘
        months: 240,           // å‰©ä½™æœŸæ•°ï¼ˆæœˆï¼‰
        annualRate: 3.1,       // å¹´åˆ©ç‡
        prepayAmount: 50000,   // æå‰è¿˜æ¬¾é‡‘é¢

        currentMonthly: 0,
        newMonthly: 0,
        totalPayBefore: 0,
        totalPayAfter: 0
    },

    watch: {
        principal: 'calculate',
        months: 'calculate',
        annualRate: 'calculate',
        prepayAmount: 'calculate'
    },

    mounted() {
        this.calculate();
    },

    methods: {
        calculate() {
            const P = Math.max(0, Number(this.principal) || 0);
            const n = Math.max(1, Number(this.months) || 1);
            const i = (Number(this.annualRate) || 0) / 100 / 12;
            const prepay = Math.min(P, Math.max(0, Number(this.prepayAmount) || 0));

            // ç­‰é¢æœ¬æ¯æœˆä¾›å…¬å¼
            const calcMonthly = (principal) => {
                if (i === 0) return principal / n;
                return principal * (i * Math.pow(1 + i, n)) / (Math.pow(1 + i, n) - 1);
            };

            // å½“å‰æœˆä¾›
            const currentMonthly = calcMonthly(P);

            // æå‰è¿˜æ¬¾åæœ¬é‡‘
            const newPrincipal = P - prepay;

            // æ–°æœˆä¾›
            const newMonthly = newPrincipal > 0 ? calcMonthly(newPrincipal) : 0;

            // æ€»è¿˜æ¬¾
            const totalPayBefore = currentMonthly * n;
            const totalPayAfter = prepay + newMonthly * n;

            // ç»Ÿä¸€ä¿ç•™ 2 ä½å°æ•°
            this.currentMonthly = Number(currentMonthly.toFixed(2));
            this.newMonthly = Number(newMonthly.toFixed(2));
            this.totalPayBefore = Number(totalPayBefore.toFixed(2));
            this.totalPayAfter = Number(totalPayAfter.toFixed(2));
        }
    }
});
</script>

</body>
</html>
